<launch>

    <!-- vehicle names (= namespace vehicle specific nodes will be launched in) -->
    <arg name="vehicle_1_name" default="uuv00" />
    <arg name="vehicle_2_name" default="uuv01" />
    <arg name="vehicle_3_name" default="uuv02" />

    <arg name="gui" default="true" />
    <arg name="verbose" default="true" />
    <arg name="rviz" default="false" />

    <arg name="x" default="0.3" />
    <arg name="y" default="0.3" />
    <arg name="z" default="0.0" />
    <arg name="Y" default="1.57" />
    <arg name="P" default="0.0" />
    <arg name="R" default="0.0" />
    
    <!-- PX4 settings -->
    <arg name="interactive" default="true" />
    <arg name="run_px4" default="true" />
    
    <!-- start gazebo with the specified world -->
    <include file="$(find hippocampus_sim)/launch/gazebo_base.launch">
        <arg name="gui" value="$(arg gui)" />
        <arg name="verbose" value="$(arg verbose)" />
    </include>

    <include file="$(find hippocampus_sim)/launch/spawn_apriltag_tank.launch" />

    <!-- Spawn Multi-Hippo-Vehicle -->
    <node name="vehicle_spawn" output="screen" pkg="gazebo_ros" type="spawn_model" args="-sdf -file $(find hippocampus_sim)/models/uuv_multi_hippocampus/uuv_multi_hippocampus_3.sdf -model uuv_hippocampus -x $(arg x) -y $(arg y) -z $(arg z) -R $(arg R) -P $(arg P) -Y $(arg Y)" />

    <!-- use the group tag to launch nodes in a namespace -->
    <group ns="$(arg vehicle_1_name)">
        <arg name="ID" value="0"/>
        <!-- MAVROS -->
        <arg name="bind_port" value="$(eval 14540 + arg('ID'))" />
        <arg name="remote_port" value="$(eval 14580 + arg('ID'))" />
        <arg name="fcu_url" default="udp://:$(arg bind_port)@localhost:$(arg remote_port)" />
        <include file="$(find mavros)/launch/px4.launch">
            <arg name="fcu_url" value="$(arg fcu_url) "/>
            <arg name="gcs_url" value="" />
            <arg name="tgt_system" value="$(eval 1 + arg('ID'))"/>
            <arg name="tgt_component" value="1" />
        </include> 

        <!-- vehicle model and px4 config -->
        <arg name="est" default="ekf2" />
        <arg name="vehicle" default="uuv_hippocampus" />
        <env name="PX4_SIM_MODEL" value="$(arg vehicle)" />
        <env name="PX4_ESTIMATOR" value="$(arg est)" />
        
        <!-- PX4 SITL -->
        <arg unless="$(arg interactive)" name="px4_command_arg1" value="-d" />
        <arg if="$(arg interactive)" name="px4_command_arg1" value="" />
        <node if="$(arg run_px4)" name="sitl_0" pkg="px4" type="px4" output="screen" args="$(find px4)/ROMFS/px4fmu_common -s etc/init.d-posix/rcS -i 0 -w sitl_$(arg vehicle)_0 $(arg px4_command_arg1)"></node>
    </group>

    <group ns="$(arg vehicle_2_name)">
        <arg name="ID" value="1"/>
        <!-- MAVROS -->
        <arg name="bind_port" value="$(eval 14540 + arg('ID'))" />
        <arg name="remote_port" value="$(eval 14580 + arg('ID'))" />
        <arg name="fcu_url" default="udp://:$(arg bind_port)@localhost:$(arg remote_port)" />
        <include file="$(find mavros)/launch/px4.launch">
            <arg name="fcu_url" value="$(arg fcu_url) "/>
            <arg name="gcs_url" value="" />
            <arg name="tgt_system" value="$(eval 1 + arg('ID'))"/>
            <arg name="tgt_component" value="1" />
        </include> 

        <!-- vehicle model and px4 config -->
        <arg name="est" default="ekf2" />
        <arg name="vehicle" default="uuv_hippocampus" />
        <env name="PX4_SIM_MODEL" value="$(arg vehicle)" />
        <env name="PX4_ESTIMATOR" value="$(arg est)" />

        <!-- PX4 SITL -->
        <arg unless="$(arg interactive)" name="px4_command_arg1" value="-d" />
        <arg if="$(arg interactive)" name="px4_command_arg1" value="" />
        <node if="$(arg run_px4)" name="sitl_1" pkg="px4" type="px4" output="screen" args="$(find px4)/ROMFS/px4fmu_common -s etc/init.d-posix/rcS -i 1 -w sitl_$(arg vehicle)_1 $(arg px4_command_arg1)"></node>
    </group>

    <group ns="$(arg vehicle_3_name)">
        <arg name="ID" value="2"/>
        <!-- MAVROS -->
        <arg name="bind_port" value="$(eval 14540 + arg('ID'))" />
        <arg name="remote_port" value="$(eval 14580 + arg('ID'))" />
        <arg name="fcu_url" default="udp://:$(arg bind_port)@localhost:$(arg remote_port)" />
        <include file="$(find mavros)/launch/px4.launch">
            <arg name="fcu_url" value="$(arg fcu_url) "/>
            <arg name="gcs_url" value="" />
            <arg name="tgt_system" value="$(eval 1 + arg('ID'))"/>
            <arg name="tgt_component" value="1" />
        </include> 

        <!-- vehicle model and px4 config -->
        <arg name="est" default="ekf2" />
        <arg name="vehicle" default="uuv_hippocampus" />
        <env name="PX4_SIM_MODEL" value="$(arg vehicle)" />
        <env name="PX4_ESTIMATOR" value="$(arg est)" />

        <!-- PX4 SITL -->
        <arg unless="$(arg interactive)" name="px4_command_arg1" value="-d" />
        <arg if="$(arg interactive)" name="px4_command_arg1" value="" />
        <node if="$(arg run_px4)" name="sitl_3" pkg="px4" type="px4" output="screen" args="$(find px4)/ROMFS/px4fmu_common -s etc/init.d-posix/rcS -i 3 -w sitl_$(arg vehicle)_3 $(arg px4_command_arg1)"></node>
    </group>

</launch>